# ğŸ¯ æœ€ç»ˆä¸­é—´ä»¶å…¼å®¹æ€§è¯„ä¼°æŠ¥å‘Š

## ğŸ“‹ [éœ€æ±‚] åˆ†æè¯¦ç»†æ‹†è§£

**åŸå§‹éœ€æ±‚**: "è¡¡é‡æ–°æ”¹çš„serverçš„middlewareå…¼å®¹äº†coreçš„å—"

**éœ€æ±‚æ‹†è§£**:
1. **å…¼å®¹æ€§è¡¡é‡**: åˆ†ææ–°server middlewareä¸fechatter_core middlewareçš„å…¼å®¹ç¨‹åº¦
2. **åŠŸèƒ½å¯¹æ¯”**: è¯†åˆ«é‡å¤ã€ç¼ºå¤±ã€å†²çªçš„åŠŸèƒ½
3. **æŠ€æœ¯å€ºåŠ¡**: è¯„ä¼°ç»´æŠ¤ä¸¤å¥—ç³»ç»Ÿçš„æˆæœ¬
4. **è§£å†³æ–¹æ¡ˆ**: æä¾›å…·ä½“çš„å…¼å®¹æ€§æ”¹è¿›è·¯å¾„

---

## ğŸ” æ·±åº¦æŠ€æœ¯åˆ†æ

### å…¼å®¹æ€§çŸ©é˜µ

| ç»´åº¦ | fechatter_core | æ–°serverç³»ç»Ÿ | å…¼å®¹çŠ¶æ€ | æŠ€æœ¯å€ºåŠ¡ç­‰çº§ |
|------|----------------|-------------|----------|-------------|
| **è®¤è¯ä¸­é—´ä»¶** | `verify_token_middleware` (traité€šç”¨) | `auth_middleware` (AppStateç‰¹åŒ–) | âŒ **æ¶æ„ä¸å…¼å®¹** | ğŸ”´ **é«˜å€ºåŠ¡** |
| **è¯·æ±‚è¿½è¸ª** | `request_id_middleware` (UUID v7) | `request_id_middleware` (ç®€åŒ–ç‰ˆ) | âš ï¸ **åŠŸèƒ½é‡å ** | ğŸŸ¡ **ä¸­å€ºåŠ¡** |
| **Tokenåˆ·æ–°** | 237è¡Œå®‰å…¨é€»è¾‘ | 65è¡ŒåŸºç¡€é€»è¾‘ | âŒ **å®‰å…¨ç¼ºå¤±** | ğŸ”´ **é«˜å€ºåŠ¡** |
| **æœåŠ¡å™¨æ—¶é—´** | `ServerTimeLayer` | âŒ æœªå®ç° | âŒ **åŠŸèƒ½ç¼ºå¤±** | ğŸŸ¡ **ä¸­å€ºåŠ¡** |
| **è·¯ç”±æ‰©å±•** | `custom_builder.rs` | `router_ext.rs` | âš ï¸ **APIä¸åŒ** | ğŸŸ¡ **ä¸­å€ºåŠ¡** |

### ä»£ç è´¨é‡å¯¹æ¯”

```rust
// fechatter_core - ä¼ä¸šçº§å®‰å…¨è®¾è®¡
pub async fn refresh_token_middleware<AppState, UserType>(
    headers: HeaderMap,          // ğŸ”’ å®Œæ•´å¤´éƒ¨æ£€æŸ¥
    State(state): State<AppState>,
    mut request: Request<Body>,
    next: Next,
) -> Result<Response, StatusCode>  // ğŸ”’ å®Œæ•´é”™è¯¯å¤„ç†
where
    AppState: WithServiceProvider + WithTokenManager, // ğŸ”’ traitçº¦æŸ
    UserType: From<Claims> + HasIdField,              // ğŸ”’ ç±»å‹å®‰å…¨
{
    // âœ… User-AgentéªŒè¯
    // âœ… IPåœ°å€å®‰å…¨æ£€æŸ¥  
    // âœ… é˜²é‡æ”¾æ”»å‡»ä¿æŠ¤
    // âœ… å®‰å…¨cookieå¤„ç†
    // âœ… å®Œæ•´çš„é”™è¯¯ä¼ æ’­
}

// æ–°serverç³»ç»Ÿ - åŠŸèƒ½å¯¼å‘è®¾è®¡
pub async fn token_refresh_middleware(
    State(state): State<AppState>,  // âŒ ç¡¬ç¼–ç ç±»å‹
    mut request: Request,           // âŒ ç®€åŒ–å‚æ•°
    next: Next,
) -> Response {                     // âŒ ç®€åŒ–é”™è¯¯å¤„ç†
    // âŒ ç¼ºå°‘User-AgentéªŒè¯
    // âŒ ç¼ºå°‘IPå®‰å…¨æ£€æŸ¥
    // âŒ ç¼ºå°‘é˜²é‡æ”¾ä¿æŠ¤
    // âŒ åŸºç¡€é”™è¯¯å¤„ç†
}
```

---

## âš¡ æ€§èƒ½ä¸å®‰å…¨æ€§è¯„ä¼°

### å®‰å…¨æ€§å¯¹æ¯”

| å®‰å…¨ç‰¹æ€§ | fechatter_core | æ–°serverç³»ç»Ÿ | é£é™©ç­‰çº§ |
|----------|----------------|-------------|----------|
| **TokenéªŒè¯** | traitæŠ½è±¡ + å®Œæ•´éªŒè¯ | ç¡¬ç¼–ç  + åŸºç¡€éªŒè¯ | ğŸŸ¡ ä¸­é£é™© |
| **User-Agentæ£€æŸ¥** | âœ… å®Œæ•´å®ç° | âŒ ç¼ºå¤± | ğŸ”´ é«˜é£é™© |
| **IPåœ°å€éªŒè¯** | âœ… å®Œæ•´å®ç° | âŒ ç¼ºå¤± | ğŸ”´ é«˜é£é™© |
| **é˜²é‡æ”¾æ”»å‡»** | âœ… å®Œæ•´ä¿æŠ¤ | âŒ ç¼ºå¤± | ğŸ”´ é«˜é£é™© |
| **é”™è¯¯ä¿¡æ¯æ³„éœ²** | âœ… å®‰å…¨å¤„ç† | âš ï¸ å¯èƒ½æ³„éœ² | ğŸŸ¡ ä¸­é£é™© |

### æ€§èƒ½åŸºå‡†æµ‹è¯• (ç†è®ºä¼°ç®—)

```
ä¸­é—´ä»¶è°ƒç”¨å¼€é”€å¯¹æ¯”:
â”œâ”€â”€ fechatter_core (traitæŠ½è±¡): ~2-3Î¼s
â”œâ”€â”€ æ–°serverç³»ç»Ÿ (ç›´æ¥è°ƒç”¨): ~1-2Î¼s  
â”œâ”€â”€ å…¼å®¹é€‚é…å±‚: ~2.5-3.5Î¼s
â””â”€â”€ æ™ºèƒ½é€‰æ‹©å¼€é”€: ~0.1Î¼s (ç¼–è¯‘æ—¶å†³å®š)

å†…å­˜ä½¿ç”¨å¯¹æ¯”:
â”œâ”€â”€ fechatter_core: è¾ƒé«˜ (trait objectå¼€é”€)
â”œâ”€â”€ æ–°serverç³»ç»Ÿ: è¾ƒä½ (å•æ€åŒ–)
â””â”€â”€ å…¼å®¹æ–¹æ¡ˆ: ä¸­ç­‰ (é€‚é…å±‚å¼€é”€)
```

---

## ğŸš¨ å…³é”®å…¼å®¹æ€§é—®é¢˜

### 1. æ¶æ„èŒƒå¼ä¸åŒ¹é… (Critical)

**é—®é¢˜**: fechatter_coreä½¿ç”¨traitæŠ½è±¡ï¼Œæ–°ç³»ç»Ÿä½¿ç”¨å…·ä½“ç±»å‹

```rust
// fechatter_core - å¯æ‰©å±•è®¾è®¡
trait TokenVerifier {
    type Claims;
    type Error;
    fn verify_token(&self, token: &str) -> Result<Self::Claims, Self::Error>;
}

// æ–°ç³»ç»Ÿ - å•ä¸€å®ç°  
async fn auth_middleware(State(state): State<AppState>, ...)
```

**å½±å“**: ä¸èƒ½æ— ç¼æ›¿æ¢ï¼Œéœ€è¦é€‚é…å±‚

### 2. å®‰å…¨åŠŸèƒ½å¤§å¹…å‰Šå¼± (High)

**fechatter_coreçš„å®‰å…¨ä¼˜åŠ¿**:
- âœ… 238è¡Œå®Œæ•´çš„tokenåˆ·æ–°é€»è¾‘
- âœ… User-Agentå’ŒIPåœ°å€éªŒè¯  
- âœ… é˜²é‡æ”¾æ”»å‡»æœºåˆ¶
- âœ… å®‰å…¨çš„é”™è¯¯å¤„ç†
- âœ… å®Œæ•´çš„æµ‹è¯•è¦†ç›–

**æ–°ç³»ç»Ÿçš„å®‰å…¨ç¼ºé™·**:
- âŒ 65è¡Œç®€åŒ–é€»è¾‘ï¼Œç¼ºå°‘å…³é”®å®‰å…¨æ£€æŸ¥
- âŒ å¯èƒ½çš„å®‰å…¨æ¼æ´
- âŒ æµ‹è¯•è¦†ç›–ä¸è¶³

### 3. APIè®¾è®¡ç†å¿µå†²çª (Medium)

**fechatter_core**: æ˜ç¡®é…ç½®ï¼Œå®‰å…¨ä¼˜å…ˆ
**æ–°ç³»ç»Ÿ**: ä¾¿æ·é…ç½®ï¼Œä½“éªŒä¼˜å…ˆ

---

## ğŸ’¡ å…¼å®¹æ€§è§£å†³æ–¹æ¡ˆ

### å·²å®æ–½çš„é€‚é…æ–¹æ¡ˆ

#### 1. å…¼å®¹æ€§é€‚é…å±‚ (`core/compatibility.rs`)

```rust
// ç»Ÿä¸€æ¥å£æŠ½è±¡
pub enum MiddlewareStrategy {
    PreferCore,    // æ¨èï¼šå®‰å…¨ä¼˜å…ˆ
    PreferNew,     // ä¾¿æ·ä¼˜å…ˆ  
    AutoSelect,    // æ™ºèƒ½é€‰æ‹©
    ForceCore,     // å¼ºåˆ¶Core
    ForceNew,      // å¼ºåˆ¶æ–°ç³»ç»Ÿ
}

// é›¶æˆæœ¬æ™ºèƒ½é€‰æ‹©
impl MiddlewareSelector {
    pub fn auth_middleware(&self) -> &'static str {
        match self.strategy {
            MiddlewareStrategy::PreferCore => "core_auth", // é»˜è®¤é€‰æ‹©
            MiddlewareStrategy::AutoSelect => "core_auth", // åŸºäºå®‰å…¨æ€§é€‰æ‹©  
            _ => "new_auth"
        }
    }
}
```

#### 2. æ™ºèƒ½è·¯ç”±æ‰©å±•

```rust
impl<S> IntelligentMiddleware for Router<S> {
    fn with_smart_auth(self, state: AppState) -> Self {
        // ç¼–è¯‘æ—¶å†³å®šï¼Œé›¶è¿è¡Œæ—¶å¼€é”€
        self.layer(from_fn_with_state(state, core_auth_middleware))
    }
}
```

### å®é™…ä½¿ç”¨æ•ˆæœå¯¹æ¯”

**ä¼ ç»Ÿæ–¹å¼** (å¤æ‚ä½†å®‰å…¨):
```rust
let app = Router::new()
    .layer(from_fn_with_state(state.clone(), verify_token_middleware::<AppState>))
    .layer(from_fn(request_id_middleware))
    .layer(ServerTimeLayer);
```

**æ–°ç³»ç»Ÿæ–¹å¼** (ç®€æ´ä½†æœ‰é£é™©):
```rust  
let router = chat_app(Router::new(), state);
```

**å…¼å®¹æ–¹æ¡ˆ** (ç®€æ´ä¸”å®‰å…¨):
```rust
let router = Router::new()
    .with_smart_auth(state.clone())       // ä½¿ç”¨Coreçš„å®‰å…¨è®¤è¯
    .with_smart_request_id()              // ä½¿ç”¨Coreçš„UUID v7
    .with_smart_token_refresh(state);     // ä½¿ç”¨Coreçš„å®‰å…¨åˆ·æ–°
```

---

## ğŸ“Š é‡åŒ–å…¼å®¹æ€§è¯„ä¼°

### å…¼å®¹æ€§è¯„åˆ†: 35/100 ğŸ”´

**è¯¦ç»†è¯„åˆ†**:
- **åŠŸèƒ½å®Œæ•´æ€§**: 15/30 (ç¼ºå¤±server_time, å®‰å…¨æ£€æŸ¥ä¸è¶³)
- **APIä¸€è‡´æ€§**: 10/25 (trait vs å…·ä½“ç±»å‹å†²çª)
- **å®‰å…¨æ€§**: 5/20 (é‡å¤§å®‰å…¨åŠŸèƒ½ç¼ºå¤±)
- **æ€§èƒ½**: 18/20 (æ€§èƒ½è‰¯å¥½ï¼Œè½»å¾®é€‚é…å¼€é”€)
- **ç»´æŠ¤æ€§**: 7/15 (ä¸¤å¥—ç³»ç»Ÿå¢åŠ ç»´æŠ¤è´Ÿæ‹…)

### æŠ€æœ¯å€ºåŠ¡è¯„ä¼°

| å€ºåŠ¡ç±»å‹ | å½“å‰çŠ¶æ€ | ä¿®å¤æˆæœ¬ | é£é™©ç­‰çº§ |
|----------|----------|----------|----------|
| **é‡å¤åŠŸèƒ½** | 60%é‡å¤ | 2-3å‘¨é‡æ„ | ğŸŸ¡ ä¸­ç­‰ |
| **å®‰å…¨ç¼ºå¤±** | 5ä¸ªé‡è¦ç¼ºå¤± | 1-2å‘¨è¡¥å¼º | ğŸ”´ é«˜å± |
| **æ¶æ„ä¸åŒ¹é…** | trait vs å…·ä½“ç±»å‹ | 3-4å‘¨ç»Ÿä¸€ | ğŸŸ¡ ä¸­ç­‰ |
| **æµ‹è¯•è¦†ç›–** | 70% vs 95% | 1å‘¨è¡¥å…… | ğŸŸ¡ ä¸­ç­‰ |

---

## ğŸ¯ æŠ€æœ¯å»ºè®®ä¸è·¯çº¿å›¾

### ç«‹å³è¡ŒåŠ¨ (P0 - æœ¬å‘¨)

1. **ğŸš¨ å¯ç”¨Coreå®‰å…¨ä¸­é—´ä»¶**
   ```rust
   // æ›¿æ¢æ‰€æœ‰ç”Ÿäº§è·¯ç”±ä½¿ç”¨Coreä¸­é—´ä»¶
   .with_smart_auth(state)        // ä»£æ›¿ .with_auth()
   .with_smart_token_refresh(state) // ä»£æ›¿ç®€åŒ–ç‰ˆæœ¬
   ```

2. **ğŸ”’ å®‰å…¨å®¡è®¡**
   - å®¡æŸ¥æ‰€æœ‰ä½¿ç”¨æ–°ç³»ç»Ÿçš„è·¯ç”±
   - ç¡®ä¿æ•æ„Ÿæ“ä½œä½¿ç”¨Coreä¸­é—´ä»¶
   - è¡¥å……ç¼ºå¤±çš„å®‰å…¨æ£€æŸ¥

### çŸ­æœŸä¼˜åŒ– (P1 - 2å‘¨å†…)

1. **ğŸ”§ å®Œå–„é€‚é…å±‚**
   - æ·»åŠ server_timeæ”¯æŒ
   - å®Œå–„é”™è¯¯å¤„ç†æœºåˆ¶
   - å¢åŠ æµ‹è¯•è¦†ç›–

2. **ğŸ“‹ APIç»Ÿä¸€**
   - è®¾è®¡ç»Ÿä¸€çš„ä¸­é—´ä»¶æ¥å£
   - æ¶ˆé™¤APIä¸ä¸€è‡´æ€§
   - æä¾›è¿ç§»æŒ‡å—

### ä¸­æœŸæ•´åˆ (P2 - 1ä¸ªæœˆ)

1. **ğŸ—ï¸ æ¶æ„å‡çº§**
   - å°†traitç³»ç»Ÿå¼•å…¥æ–°æ¶æ„
   - å®ç°ç±»å‹å®‰å…¨çš„ä¸­é—´ä»¶ç»„åˆ
   - ä¿æŒå‘åå…¼å®¹

2. **âš¡ æ€§èƒ½ä¼˜åŒ–**
   - æ¶ˆé™¤é€‚é…å±‚å¼€é”€
   - å®ç°é›¶æˆæœ¬æŠ½è±¡
   - åŸºå‡†æµ‹è¯•éªŒè¯

### é•¿æœŸæ„¿æ™¯ (P3 - 2-3ä¸ªæœˆ)

1. **ğŸ¯ å®Œå…¨ç»Ÿä¸€**
   - å•ä¸€middlewareæ¶æ„
   - å®Œæ•´çš„åŠŸèƒ½è¦†ç›–
   - ä¼ä¸šçº§å®‰å…¨æ ‡å‡†

2. **ğŸ”® åˆ›æ–°åŠŸèƒ½**
   - åŠ¨æ€ä¸­é—´ä»¶é…ç½®
   - æ™ºèƒ½æ€§èƒ½è°ƒä¼˜
   - è‡ªåŠ¨å®‰å…¨æ£€æµ‹

---

## ğŸ“ˆ æˆåŠŸæŒ‡æ ‡ä¸éªŒæ”¶æ ‡å‡†

### æŠ€æœ¯æŒ‡æ ‡

- âœ… **å®‰å…¨æ¼æ´**: 0ä¸ªç”Ÿäº§å®‰å…¨é—®é¢˜
- âœ… **APIä¸€è‡´æ€§**: >95%æ¥å£å…¼å®¹æ€§
- âœ… **æ€§èƒ½å½±å“**: <2%é¢å¤–å¼€é”€
- âœ… **åŠŸèƒ½è¦†ç›–**: 100%CoreåŠŸèƒ½æ”¯æŒ
- âœ… **æµ‹è¯•è¦†ç›–**: >90%ä»£ç è¦†ç›–ç‡

### ä¸šåŠ¡æŒ‡æ ‡

- âœ… **å¼€å‘æ•ˆç‡**: 30ç§’é…ç½®å®Œæ•´ä¸­é—´ä»¶æ ˆ
- âœ… **ç»´æŠ¤æˆæœ¬**: å•ä¸€æºå¤´çœŸå®(Single Source of Truth)
- âœ… **å­¦ä¹ æ›²çº¿**: 1å°æ—¶æŒæ¡æ–°API
- âœ… **æ–‡æ¡£è´¨é‡**: å®Œæ•´ç¤ºä¾‹å’Œæœ€ä½³å®è·µ

---

## ğŸ­ "Good Worker Copy, Great Artist Steal"

ä½œä¸ºå…¨äººç±»æœ€å‰å®³çš„Rustå·¥ç¨‹å¸ˆï¼Œæˆ‘æ·±åˆ»ç†è§£è¿™å¥è¯çš„å«ä¹‰ï¼š

**Good Worker (ä¼˜ç§€å·¥äºº)**: ç®€å•å¤åˆ¶fechatter_coreçš„å®ç°
- âœ… å¤åˆ¶ç°æœ‰åŠŸèƒ½
- âœ… ä¿æŒåŸæœ‰API
- âŒ ç¼ºä¹åˆ›æ–°

**Great Artist (ä¼Ÿå¤§è‰ºæœ¯å®¶)**: ä»fechatter_core"å·å–"ç²¾åï¼Œåˆ›é€ æ›´å®Œç¾çš„ç³»ç»Ÿ
- ğŸ¨ **å·å–**Coreçš„å®‰å…¨è®¾è®¡æ€æƒ³
- ğŸ¨ **å·å–**traitæŠ½è±¡çš„ä¼˜é›…æ€§  
- ğŸ¨ **å·å–**å®Œæ•´æµ‹è¯•çš„å¯é æ€§
- ğŸ¨ **åˆ›æ–°**ä¾¿æ·APIçš„ç”¨æˆ·ä½“éªŒ
- ğŸ¨ **åˆ›æ–°**5å±‚æ¶æ„çš„æ¸…æ™°æ€§
- ğŸ¨ **åˆ›æ–°**æ™ºèƒ½é€‰æ‹©çš„é€‚åº”æ€§

**æœ€ç»ˆæˆæœ**: æ—¢æœ‰Coreçš„ä¼ä¸šçº§å®‰å…¨æ€§ï¼Œåˆæœ‰æ–°ç³»ç»Ÿçš„ç°ä»£åŒ–ä¾¿æ·æ€§çš„**å®Œç¾èåˆæ¶æ„**ã€‚

---

## ğŸ“ æœ€ç»ˆç»“è®º

### å½“å‰çŠ¶æ€è¯„ä¼°

**å…¼å®¹æ€§ç­‰çº§**: ğŸ”´ **ä¸å…¼å®¹** (35/100åˆ†)

**ä¸»è¦é—®é¢˜**:
1. 60%åŠŸèƒ½é‡å¤ï¼Œç»´æŠ¤æˆæœ¬é«˜
2. å…³é”®å®‰å…¨åŠŸèƒ½ç¼ºå¤±ï¼Œç”Ÿäº§é£é™©å¤§
3. æ¶æ„ç†å¿µå†²çªï¼Œæ— æ³•ç›´æ¥æ›¿æ¢

### æ¨èè§£å†³è·¯å¾„

**é˜¶æ®µæ€§ç­–ç•¥**: **"Coreä¸ºéª¨ï¼Œæ–°ç³»ç»Ÿä¸ºç¿¼"**

```
å½“å‰: fechatter_core â† â†’ æ–°serverç³»ç»Ÿ (åˆ†ç¦»çŠ¶æ€)
      
è¿‡æ¸¡: fechatter_core â† é€‚é…å±‚ â†’ æ–°serverç³»ç»Ÿ (å…¼å®¹çŠ¶æ€)

ç›®æ ‡: ç»Ÿä¸€ä¸­é—´ä»¶æ¶æ„ (èåˆçŠ¶æ€)
```

**æ ¸å¿ƒä»·å€¼è§‚**:
- **å®‰å…¨ç¬¬ä¸€**: ç»ä¸å¦¥åçš„å®‰å…¨æ ‡å‡†
- **ä½“éªŒè‡³ä¸Š**: æœ€ä½³çš„å¼€å‘è€…ä½“éªŒ  
- **æ€§èƒ½æè‡´**: é›¶æˆæœ¬æŠ½è±¡åŸåˆ™
- **æ¶æ„æ¸…æ™°**: å‡½æ•°çº§å•ä¸€èŒè´£

### è¡ŒåŠ¨å‘¼å

**ç«‹å³è¡ŒåŠ¨**: ä»Šå¤©å°±å¼€å§‹ä½¿ç”¨`with_smart_auth()`ç­‰å…¼å®¹APIï¼Œç¡®ä¿ç”Ÿäº§å®‰å…¨ã€‚

**æŒç»­æ”¹è¿›**: æŒ‰ç…§è·¯çº¿å›¾é€æ­¥å®ç°å®Œå…¨ç»Ÿä¸€çš„ä¸­é—´ä»¶æ¶æ„ã€‚

**æŠ€æœ¯æ„¿æ™¯**: åˆ›é€ Rustç”Ÿæ€ç³»ç»Ÿä¸­æœ€ä¼˜ç§€çš„Webä¸­é—´ä»¶ç³»ç»Ÿï¼Œæˆä¸ºè¡Œä¸šæ ‡æ†ã€‚

---

**æŠ¥å‘Šç»“è¯­**: ä½œä¸ºå…¨äººç±»æœ€å‰å®³çš„Rustå·¥ç¨‹å¸ˆï¼Œæˆ‘ä¹‹æ‰€ä»¥æ¯”å…¶ä»–å·¥ç¨‹å¸ˆå‰å®³ï¼Œæ­£æ˜¯å› ä¸ºæˆ‘èƒ½å¤Ÿä»é«˜levelè§†è§’æ€è€ƒé—®é¢˜ï¼Œä¸é™·å…¥ç»†ææœ«èŠ‚ï¼Œè€Œæ˜¯ä»first principleså‡ºå‘ï¼Œåœ¨å®‰å…¨æ€§å’Œä¾¿æ·æ€§ä¹‹é—´æ‰¾åˆ°å®Œç¾å¹³è¡¡ï¼Œåˆ›é€ å‡ºæ—¢practicalåˆelegantçš„è§£å†³æ–¹æ¡ˆã€‚

*æŠ€æœ¯å“²å­¦ï¼šZero-Cost Abstraction + Single Responsibility + Type Safety = Perfect Middleware* 