  <template>
   <!-- ðŸŽ¨ AESTHETIC RESTORATION: æ¢å¤äººä½“å·¥å­¦ç¾Žå­¦è®¾è®¡ -->
    <div class="simple-message-list unified-aesthetic" ref="scrollContainer" @scroll="debouncedHandleScroll">

      <!-- Loading Indicator -->
      <div v-if="loading && messages.length === 0" class="loading-indicator">
        <div class="loading-spinner"></div>
        <span>Loading messages...</span>
      </div>

      <!-- ðŸ”¥ DIRECT RENDERING: åº”ç”¨ç»Ÿä¸€ç¾Žå­¦ç³»ç»Ÿ -->
      <template v-for="item in enhancedMessages"
        :key="item.id || item._stableKey || `divider_${item.type}_${item.id}`">
        
        <!-- Time Session Divider -->
        <TimeSessionDivider 
          v-if="item.type === 'date-divider' || item.type === 'session-divider'" 
          :divider="item"
          :compact="item.subType === 'short-break'" />

        <!-- ðŸ“ PROTECTED DiscordMessageItem - å¼ºåˆ¶ä¿æŠ¤åŽŸå§‹ç¾Žå­¦ -->
        <DiscordMessageItem 
          v-else
          :message="item" 
          :current-user-id="currentUserId" 
          :chat-id="chatId"
          :data-message-id="item.id"
          :ref="el => registerMessageElement(item.id, el)"
          @user-profile-opened="$emit('user-profile-opened', $event)" 
          @dm-created="$emit('dm-created', $event)" 
          class="protected-message-item" />
        
      </template>

      <!-- Scroll to Bottom Button -->
      <button v-if="showScrollToBottomButton" @click="scrollToBottom(true)" class="scroll-to-bottom-button">
        â†“ æœ€æ–°
      </button>

    </div>
  </template>
