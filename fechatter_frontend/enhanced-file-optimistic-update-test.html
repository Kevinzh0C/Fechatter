<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🚀 增强文件乐观更新系统测试</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      color: #333;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .header h1 {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .header p {
      font-size: 16px;
      opacity: 0.9;
    }

    .content {
      padding: 30px;
    }

    .test-section {
      background: #f8f9ff;
      border: 2px solid #e3e8ff;
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 25px;
    }

    .test-section h3 {
      color: #4f46e5;
      font-size: 18px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .file-input-area {
      border: 3px dashed #4f46e5;
      border-radius: 12px;
      padding: 30px;
      text-align: center;
      background: white;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .file-input-area:hover {
      border-color: #3730a3;
      background: #f8f9ff;
    }

    .file-input-area.drag-over {
      border-color: #10b981;
      background: #ecfdf5;
    }

    .file-input {
      display: none;
    }

    .upload-icon {
      font-size: 48px;
      color: #4f46e5;
      margin-bottom: 15px;
    }

    .upload-text {
      font-size: 16px;
      font-weight: 600;
      color: #374151;
      margin-bottom: 8px;
    }

    .upload-hint {
      font-size: 14px;
      color: #6b7280;
    }

    .message-preview {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 20px;
      margin-top: 15px;
    }

    .message-item {
      display: flex;
      gap: 15px;
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 15px;
      transition: all 0.3s ease;
    }

    .message-item.optimistic {
      background: linear-gradient(135deg, #fef3c7 0%, #fbbf24 100%);
      border: 2px solid #f59e0b;
    }

    .message-item.uploading {
      background: linear-gradient(135deg, #dbeafe 0%, #3b82f6 100%);
      border: 2px solid #2563eb;
    }

    .message-item.sending {
      background: linear-gradient(135deg, #e0e7ff 0%, #6366f1 100%);
      border: 2px solid #4f46e5;
    }

    .message-item.sent {
      background: linear-gradient(135deg, #d1fae5 0%, #10b981 100%);
      border: 2px solid #059669;
    }

    .message-item.failed {
      background: linear-gradient(135deg, #fee2e2 0%, #ef4444 100%);
      border: 2px solid #dc2626;
    }

    .avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      flex-shrink: 0;
    }

    .message-content {
      flex: 1;
    }

    .message-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }

    .sender-name {
      font-weight: 600;
      color: #374151;
    }

    .timestamp {
      font-size: 12px;
      color: #6b7280;
    }

    .message-text {
      margin-bottom: 10px;
      color: #374151;
    }

    .file-attachments {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .file-attachment {
      background: rgba(255, 255, 255, 0.8);
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: 8px;
      padding: 12px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .file-icon {
      font-size: 24px;
    }

    .file-info {
      flex: 1;
    }

    .file-name {
      font-weight: 600;
      font-size: 14px;
      color: #374151;
    }

    .file-size {
      font-size: 12px;
      color: #6b7280;
    }

    .file-status {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
    }

    .status-text {
      font-size: 12px;
      font-weight: 600;
      padding: 4px 8px;
      border-radius: 12px;
    }

    .status-uploading {
      background: #3b82f6;
      color: white;
    }

    .status-uploaded {
      background: #10b981;
      color: white;
    }

    .status-failed {
      background: #ef4444;
      color: white;
    }

    .progress-bar {
      width: 100px;
      height: 4px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 2px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: white;
      transition: width 0.3s ease;
    }

    .controls {
      background: #f9fafb;
      border-radius: 12px;
      padding: 20px;
      margin-top: 15px;
    }

    .control-group {
      display: flex;
      gap: 15px;
      margin-bottom: 15px;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(79, 70, 229, 0.3);
    }

    .btn-secondary {
      background: #f3f4f6;
      color: #374151;
      border: 1px solid #d1d5db;
    }

    .btn-secondary:hover {
      background: #e5e7eb;
    }

    .btn-danger {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
    }

    .btn-danger:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(239, 68, 68, 0.3);
    }

    .logs {
      background: #1f2937;
      color: #e5e7eb;
      border-radius: 8px;
      padding: 15px;
      font-family: 'Monaco', 'Consolas', monospace;
      font-size: 12px;
      max-height: 200px;
      overflow-y: auto;
      margin-top: 15px;
    }

    .log-entry {
      margin-bottom: 5px;
      padding: 2px 0;
    }

    .log-timestamp {
      color: #9ca3af;
    }

    .log-level-info {
      color: #60a5fa;
    }

    .log-level-success {
      color: #34d399;
    }

    .log-level-error {
      color: #f87171;
    }

    .log-level-warning {
      color: #fbbf24;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .stat-card {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
    }

    .stat-value {
      font-size: 24px;
      font-weight: 700;
      color: #4f46e5;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 14px;
      color: #6b7280;
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.7;
      }
    }

    .pulsing {
      animation: pulse 1.5s infinite;
    }

    .testing-indicator {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #10b981;
      color: white;
      padding: 10px 20px;
      border-radius: 25px;
      font-weight: 600;
      font-size: 14px;
      z-index: 1000;
      transform: translateX(100%);
      transition: transform 0.3s ease;
    }

    .testing-indicator.active {
      transform: translateX(0);
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>🚀 增强文件乐观更新系统测试</h1>
      <p>测试分阶段文件上传、进度跟踪和状态管理</p>
    </div>

    <div class="content">
      <!-- File Upload Test Section -->
      <div class="test-section">
        <h3>📤 文件上传测试</h3>

        <div class="file-input-area" onclick="document.getElementById('fileInput').click()">
          <div class="upload-icon">📁</div>
          <div class="upload-text">点击选择文件或拖拽到此区域</div>
          <div class="upload-hint">支持图片、文档等文件类型 (最大2MB)</div>
        </div>

        <input type="file" id="fileInput" class="file-input" multiple accept="image/*,application/pdf,.doc,.docx,.txt">

        <div class="controls">
          <div class="control-group">
            <button class="btn btn-primary" onclick="simulateFileUpload()">
              📤 模拟文件上传
            </button>
            <button class="btn btn-secondary" onclick="simulateTextMessage()">
              📝 发送文本消息
            </button>
            <button class="btn btn-danger" onclick="clearMessages()">
              🗑️ 清空消息
            </button>
          </div>

          <div class="control-group">
            <button class="btn btn-secondary" onclick="simulateNetworkError()">
              🌐 模拟网络错误
            </button>
            <button class="btn btn-secondary" onclick="simulateSSEDelay()">
              ⏱️ 模拟SSE延迟
            </button>
            <button class="btn btn-secondary" onclick="simulateUploadFailure()">
              ❌ 模拟上传失败
            </button>
          </div>
        </div>
      </div>

      <!-- Message Preview Section -->
      <div class="test-section">
        <h3>💬 消息预览</h3>
        <div class="message-preview" id="messagePreview">
          <div style="text-align: center; color: #6b7280; padding: 40px;">
            等待消息...
          </div>
        </div>
      </div>

      <!-- Logs Section -->
      <div class="test-section">
        <h3>📋 测试日志</h3>
        <div class="logs" id="logs"></div>
      </div>

      <!-- Statistics Section -->
      <div class="test-section">
        <h3>📊 统计信息</h3>
        <div class="stats">
          <div class="stat-card">
            <div class="stat-value" id="totalMessages">0</div>
            <div class="stat-label">总消息数</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="fileMessages">0</div>
            <div class="stat-label">文件消息</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="successRate">100%</div>
            <div class="stat-label">成功率</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="avgUploadTime">-</div>
            <div class="stat-label">平均上传时间</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="testing-indicator" id="testingIndicator">
    🧪 正在测试...
  </div>

  <script>
    // State management
    let messages = [];
    let stats = {
      totalMessages: 0,
      fileMessages: 0,
      successfulUploads: 0,
      failedUploads: 0,
      uploadTimes: []
    };

    // Message status constants
    const MESSAGE_STATUS = {
      FILE_UPLOADING: 'file_uploading',
      FILE_UPLOADED: 'file_uploaded',
      SENDING: 'sending',
      SENT: 'sent',
      DELIVERED: 'delivered',
      FAILED: 'failed'
    };

    // File status constants
    const FILE_STATUS = {
      UPLOADING: 'uploading',
      UPLOADED: 'uploaded',
      FAILED: 'failed'
    };

    // Initialize
    document.addEventListener('DOMContentLoaded', function () {
      setupFileInputEvents();
      log('系统初始化完成', 'info');
    });

    // File input event handlers
    function setupFileInputEvents() {
      const fileInput = document.getElementById('fileInput');
      const fileInputArea = document.querySelector('.file-input-area');

      fileInput.addEventListener('change', handleFileSelection);

      // Drag and drop support
      fileInputArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        fileInputArea.classList.add('drag-over');
      });

      fileInputArea.addEventListener('dragleave', () => {
        fileInputArea.classList.remove('drag-over');
      });

      fileInputArea.addEventListener('drop', (e) => {
        e.preventDefault();
        fileInputArea.classList.remove('drag-over');

        const files = Array.from(e.dataTransfer.files);
        if (files.length > 0) {
          handleFiles(files);
        }
      });
    }

    // Handle file selection
    function handleFileSelection(event) {
      const files = Array.from(event.target.files);
      if (files.length > 0) {
        handleFiles(files);
      }
    }

    // Handle files
    function handleFiles(files) {
      log(`选择了 ${files.length} 个文件`, 'info');

      files.forEach(file => {
        if (file.size > 2 * 1024 * 1024) { // 2MB limit
          log(`文件 ${file.name} 超过2MB限制`, 'error');
          return;
        }

        simulateFileMessage(file);
      });
    }

    // Simulate file message with enhanced optimistic updates
    async function simulateFileMessage(file) {
      const messageId = generateId();
      const startTime = Date.now();

      showTestingIndicator();

      // Step 1: Create optimistic message with file preview
      const optimisticMessage = createOptimisticMessage(messageId, '', [file]);
      messages.push(optimisticMessage);
      updateMessagePreview();

      log(`📤 创建乐观消息: ${messageId}`, 'info');

      try {
        // Step 2: Simulate file upload with progress
        await simulateFileUpload(messageId, 0, file, startTime);

        // Step 3: Simulate message sending
        await simulateMessageSending(messageId);

        // Step 4: Simulate SSE confirmation
        await simulateSSEConfirmation(messageId);

        stats.successfulUploads++;
        stats.uploadTimes.push(Date.now() - startTime);

        log(`✅ 文件消息发送成功: ${messageId}`, 'success');

      } catch (error) {
        handleMessageFailure(messageId, error.message);
        stats.failedUploads++;
        log(`❌ 文件消息发送失败: ${error.message}`, 'error');
      }

      updateStats();
      hideTestingIndicator();
    }

    // Create optimistic message
    function createOptimisticMessage(id, content, files = []) {
      stats.totalMessages++;
      if (files.length > 0) stats.fileMessages++;

      return {
        id: id,
        temp_id: id,
        content: content,
        sender_name: 'Test User',
        created_at: new Date().toISOString(),
        status: files.length > 0 ? MESSAGE_STATUS.FILE_UPLOADING : MESSAGE_STATUS.SENDING,
        files: files.map(file => ({
          id: generateId(),
          filename: file.name,
          size: file.size,
          mime_type: file.type,
          upload_status: FILE_STATUS.UPLOADING,
          upload_progress: 0,
          local_url: URL.createObjectURL(file),
          server_url: null,
          upload_error: null
        })),
        isOptimistic: true,
        sentAt: Date.now()
      };
    }

    // Simulate file upload with progress
    async function simulateFileUpload(messageId, fileIndex, file, startTime) {
      const message = messages.find(m => m.id === messageId);
      if (!message || !message.files[fileIndex]) return;

      log(`📤 开始上传文件: ${file.name}`, 'info');

      // Simulate upload progress
      for (let progress = 0; progress <= 100; progress += 10) {
        message.files[fileIndex].upload_progress = progress;
        updateMessagePreview();

        await delay(100); // Simulate upload time
      }

      // Mark file as uploaded
      message.files[fileIndex].upload_status = FILE_STATUS.UPLOADED;
      message.files[fileIndex].server_url = `https://example.com/files/${generateId()}`;
      message.status = MESSAGE_STATUS.FILE_UPLOADED;

      updateMessagePreview();
      log(`✅ 文件上传完成: ${file.name}`, 'success');
    }

    // Simulate message sending
    async function simulateMessageSending(messageId) {
      const message = messages.find(m => m.id === messageId);
      if (!message) return;

      log(`📨 开始发送消息: ${messageId}`, 'info');

      message.status = MESSAGE_STATUS.SENDING;
      updateMessagePreview();

      await delay(500); // Simulate API call time

      message.status = MESSAGE_STATUS.SENT;
      message.id = generateId(); // New server ID
      message.isOptimistic = false;

      updateMessagePreview();
      log(`✅ 消息发送成功: ${messageId}`, 'success');
    }

    // Simulate SSE confirmation
    async function simulateSSEConfirmation(messageId) {
      const message = messages.find(m => m.id === messageId);
      if (!message) return;

      log(`📨 等待SSE确认: ${messageId}`, 'info');

      await delay(1000 + Math.random() * 2000); // Random SSE delay

      message.status = MESSAGE_STATUS.DELIVERED;
      message.delivered_at = new Date().toISOString();

      updateMessagePreview();
      log(`✅ SSE确认完成: ${messageId}`, 'success');
    }

    // Handle message failure
    function handleMessageFailure(messageId, errorMessage) {
      const message = messages.find(m => m.id === messageId);
      if (!message) return;

      message.status = MESSAGE_STATUS.FAILED;
      message.error = errorMessage;

      // Mark all files as failed
      message.files.forEach(file => {
        file.upload_status = FILE_STATUS.FAILED;
        file.upload_error = errorMessage;
      });

      updateMessagePreview();
    }

    // Simulate various scenarios
    function simulateFileUpload() {
      const mockFile = new File(['mock content'], 'test-image.jpg', { type: 'image/jpeg' });
      simulateFileMessage(mockFile);
    }

    function simulateTextMessage() {
      const messageId = generateId();
      const message = createOptimisticMessage(messageId, '这是一条测试文本消息');
      messages.push(message);
      updateMessagePreview();

      setTimeout(() => {
        message.status = MESSAGE_STATUS.SENT;
        updateMessagePreview();
        setTimeout(() => {
          message.status = MESSAGE_STATUS.DELIVERED;
          updateMessagePreview();
        }, 1000);
      }, 500);

      updateStats();
    }

    function simulateNetworkError() {
      const mockFile = new File(['error content'], 'error-test.jpg', { type: 'image/jpeg' });
      const messageId = generateId();
      const message = createOptimisticMessage(messageId, '', [mockFile]);
      messages.push(message);
      updateMessagePreview();

      setTimeout(() => {
        handleMessageFailure(messageId, 'Network connection failed');
        updateStats();
      }, 2000);
    }

    function simulateSSEDelay() {
      const mockFile = new File(['sse delay'], 'sse-delay-test.jpg', { type: 'image/jpeg' });
      simulateFileMessage(mockFile);
    }

    function simulateUploadFailure() {
      const mockFile = new File(['upload fail'], 'upload-fail-test.jpg', { type: 'image/jpeg' });
      const messageId = generateId();
      const message = createOptimisticMessage(messageId, '', [mockFile]);
      messages.push(message);
      updateMessagePreview();

      setTimeout(() => {
        message.files[0].upload_status = FILE_STATUS.FAILED;
        message.files[0].upload_error = 'Upload server error';
        message.status = MESSAGE_STATUS.FAILED;
        updateMessagePreview();
        updateStats();
      }, 1500);
    }

    function clearMessages() {
      messages = [];
      stats = {
        totalMessages: 0,
        fileMessages: 0,
        successfulUploads: 0,
        failedUploads: 0,
        uploadTimes: []
      };
      updateMessagePreview();
      updateStats();
      document.getElementById('logs').innerHTML = '';
      log('消息已清空', 'info');
    }

    // Update message preview
    function updateMessagePreview() {
      const preview = document.getElementById('messagePreview');

      if (messages.length === 0) {
        preview.innerHTML = '<div style="text-align: center; color: #6b7280; padding: 40px;">等待消息...</div>';
        return;
      }

      preview.innerHTML = messages.map(message => renderMessage(message)).join('');
    }

    // Render message
    function renderMessage(message) {
      const statusClass = getMessageStatusClass(message.status);
      const statusEmoji = getStatusEmoji(message.status);

      let filesHTML = '';
      if (message.files && message.files.length > 0) {
        filesHTML = `
                    <div class="file-attachments">
                        ${message.files.map(file => renderFile(file)).join('')}
                    </div>
                `;
      }

      return `
                <div class="message-item ${statusClass}">
                    <div class="avatar">T</div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="sender-name">${message.sender_name}</span>
                            <span class="timestamp">${formatTime(message.created_at)}</span>
                            <span>${statusEmoji} ${getStatusText(message.status)}</span>
                        </div>
                        ${message.content ? `<div class="message-text">${message.content}</div>` : ''}
                        ${filesHTML}
                    </div>
                </div>
            `;
    }

    // Render file
    function renderFile(file) {
      const progressHTML = file.upload_status === FILE_STATUS.UPLOADING ? `
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${file.upload_progress}%"></div>
                </div>
            ` : '';

      return `
                <div class="file-attachment">
                    <div class="file-icon">${getFileIcon(file.mime_type)}</div>
                    <div class="file-info">
                        <div class="file-name">${file.filename}</div>
                        <div class="file-size">${formatFileSize(file.size)}</div>
                    </div>
                    <div class="file-status">
                        <div class="status-text status-${file.upload_status}">
                            ${getFileStatusText(file.upload_status, file.upload_progress)}
                        </div>
                        ${progressHTML}
                        ${file.upload_error ? `<div style="font-size: 10px; color: #ef4444;">${file.upload_error}</div>` : ''}
                    </div>
                </div>
            `;
    }

    // Update statistics
    function updateStats() {
      document.getElementById('totalMessages').textContent = stats.totalMessages;
      document.getElementById('fileMessages').textContent = stats.fileMessages;

      const totalAttempts = stats.successfulUploads + stats.failedUploads;
      const successRate = totalAttempts > 0 ? Math.round((stats.successfulUploads / totalAttempts) * 100) : 100;
      document.getElementById('successRate').textContent = `${successRate}%`;

      const avgTime = stats.uploadTimes.length > 0 ?
        Math.round(stats.uploadTimes.reduce((a, b) => a + b, 0) / stats.uploadTimes.length) : 0;
      document.getElementById('avgUploadTime').textContent = avgTime > 0 ? `${avgTime}ms` : '-';
    }

    // Utility functions
    function generateId() {
      return `msg_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    }

    function delay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    function getMessageStatusClass(status) {
      const classMap = {
        [MESSAGE_STATUS.FILE_UPLOADING]: 'uploading',
        [MESSAGE_STATUS.FILE_UPLOADED]: 'uploading',
        [MESSAGE_STATUS.SENDING]: 'sending',
        [MESSAGE_STATUS.SENT]: 'sent',
        [MESSAGE_STATUS.DELIVERED]: 'sent',
        [MESSAGE_STATUS.FAILED]: 'failed'
      };
      return classMap[status] || 'optimistic';
    }

    function getStatusEmoji(status) {
      const emojiMap = {
        [MESSAGE_STATUS.FILE_UPLOADING]: '📤',
        [MESSAGE_STATUS.FILE_UPLOADED]: '✅',
        [MESSAGE_STATUS.SENDING]: '📨',
        [MESSAGE_STATUS.SENT]: '✅',
        [MESSAGE_STATUS.DELIVERED]: '✅✅',
        [MESSAGE_STATUS.FAILED]: '❌'
      };
      return emojiMap[status] || '⏳';
    }

    function getStatusText(status) {
      const textMap = {
        [MESSAGE_STATUS.FILE_UPLOADING]: '正在上传文件...',
        [MESSAGE_STATUS.FILE_UPLOADED]: '文件已上传',
        [MESSAGE_STATUS.SENDING]: '正在发送...',
        [MESSAGE_STATUS.SENT]: '已发送',
        [MESSAGE_STATUS.DELIVERED]: '已送达',
        [MESSAGE_STATUS.FAILED]: '发送失败'
      };
      return textMap[status] || '处理中';
    }

    function getFileStatusText(status, progress) {
      if (status === FILE_STATUS.UPLOADING) {
        return `上传中 ${progress}%`;
      } else if (status === FILE_STATUS.UPLOADED) {
        return '已上传';
      } else if (status === FILE_STATUS.FAILED) {
        return '上传失败';
      }
      return '等待中';
    }

    function getFileIcon(mimeType) {
      if (mimeType.startsWith('image/')) return '🖼️';
      if (mimeType.includes('pdf')) return '📄';
      if (mimeType.includes('doc')) return '📝';
      return '📎';
    }

    function formatFileSize(bytes) {
      if (bytes === 0) return '0 B';
      const k = 1024;
      const sizes = ['B', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    function formatTime(dateString) {
      return new Date(dateString).toLocaleTimeString();
    }

    function showTestingIndicator() {
      document.getElementById('testingIndicator').classList.add('active');
    }

    function hideTestingIndicator() {
      setTimeout(() => {
        document.getElementById('testingIndicator').classList.remove('active');
      }, 1000);
    }

    function log(message, level = 'info') {
      const logs = document.getElementById('logs');
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = document.createElement('div');
      logEntry.className = 'log-entry';

      logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="log-level-${level}">[${level.toUpperCase()}]</span>
                ${message}
            `;

      logs.appendChild(logEntry);
      logs.scrollTop = logs.scrollHeight;
    }
  </script>
</body>

</html>